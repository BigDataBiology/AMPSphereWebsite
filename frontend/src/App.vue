<template>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <div id="AMPSphere">
    <el-container>
      <el-header height="150px">
        <div class="header-wrapper">
          <div class="logo">
            <el-image style="height: 150px; width: 150px" :src="url" lazy></el-image>
          </div>
          <div class="search-box">
            <el-input placeholder="Text search" v-model="searchTerm" @keyup.enter="textSearch" clearable
                      maxlength="40" show-word-limit=true>
              <template v-slot:append>
                <el-button type="success" icon="el-icon-search" @click="textSearch">Search</el-button>
              </template>
            </el-input>
            <span>
              <br/><br/>
              Examples:
              <el-link href="/AMP?accession=AMP10.000_000" target="_blank" type="primary">AMP10.000_000</el-link>,
              <el-link href="/family?accession=SPHERE-III.001_396" target="_blank" type="primary">SPHERE-III.001_396</el-link>

            </span>
          </div>
          <div class="menu">
            <el-menu mode="horizontal" :default-active="activeMenuItem" :router="true">
              <el-menu-item index="home">Home</el-menu-item>
              <el-menu-item index="browse_data">Browse data</el-menu-item>
<!--              <el-menu-item index="tools">Tools</el-menu-item>-->
              <el-menu-item index="api">API</el-menu-item>
              <el-menu-item index="downloads">Downloads</el-menu-item>
<!--              <el-menu-item index="citation">Citation</el-menu-item>-->
              <el-menu-item index="help">Help</el-menu-item>
              <el-menu-item index="contact">Contact</el-menu-item>
              <el-menu-item index="about">About</el-menu-item>
            </el-menu>
          </div>
        </div>
      </el-header>

      <el-main>
<!--        Use CDN to speed up the production build: https://segmentfault.com/a/1190000015709430-->
        <el-row>
          <el-col :offset="1" :span="22">
            <div>
              <router-view/>
            </div>
          </el-col>
        </el-row>
      </el-main>

      <el-footer height="120px">
        <el-row type="flex" justify="center">
          <el-col :span="22" :offset="1" type="flex" justify="bottom">
            <el-divider></el-divider>
            Powered by
            <el-link href="https://vuejs.org/index.html" type="success">Vue.js</el-link>
            <el-divider direction="vertical"></el-divider>
            <el-link href="https://element-plus.org/#/en-US" type="primary">Element</el-link>
            <el-divider direction="vertical"></el-divider>
            <el-link href="https://fastapi.tiangolo.com/" type="success">FastAPI</el-link>
          </el-col>
        </el-row>
        <el-row type="flex" justify="center">
          <el-col :span="22" :offset="1" type="flex" justify="bottom">
            &copy;2021-{{year}}
            <el-link href="https://www.fudan.edu.cn/" type="warning">Fudan University</el-link>
            All Rights Reserved.
          </el-col>
        </el-row>
      </el-footer>
    </el-container>
  </div>
</template>

<style>
.header-wrapper {
  display: grid;
  grid-template-columns: repeat(24, 1fr);
  grid-template-rows: repeat(3, 1fr);
}
.logo{
  grid-column-start: 2;
  grid-column-end: 5;
  grid-row-start: 1;
  grid-row-end: 3;
}
.search-box{
  grid-column-start: 14;
  grid-column-end: 24;
  grid-row-start: 1;
  grid-row-end: 1;
}
.search-example{
  grid-column-start: 14;
  grid-column-end: 24;
  grid-row-start: 2;
  grid-row-end: 2;
  vertical-align: top;
  text-align: left;
  line-height: 10px;
}
.menu{
  grid-column-start: 7;
  grid-column-end: 20;
  grid-row-start: 2;
  grid-row-end: 3;
}
.el-footer{
  bottom: 0;
  width: 100%;
  height: 100px;
  background-color: #ffffff;
}
</style>

<script>
export default {
  name: 'AMPSphere',
  data() {
    return {
      home: 'home',
      activeMenuItem: '',
      searchTerm: '',
      loading: false,
      url: require('./assets/ampsphere_logo.svg'),
    };
  },
  created() {
    // let self = this
    // // https://stackoverflow.com/questions/50768678/axios-ajax-show-loading-when-making-ajax-request
    // this.axios.interceptors.request.use((config) => {
    //   self.loading = true
    //   // trigger 'loading=true' event here
    //   return config;
    // }, (error) => {
    //   self.loading = false
    //   // trigger 'loading=false' event here
    //   return Promise.reject(error);
    // });
    // this.axios.interceptors.response.use((response) => {
    //   self.loading = true
    //   // trigger 'loading=false' event here
    //   return response;
    // }, (error) => {
    //   self.loading = false
    //   // trigger 'loading=false' event here
    //   return Promise.reject(error);
    // });
  },
  mounted() {
    this.activeMenuItem=window.location.href.split('/')[3];
  },
  computed: {
    year: function () {
      return new Date().getFullYear();
    }
  },
  methods: {
    textSearch(){
      if (this.searchTerm.startsWith('AMP')) {
        window.open('/AMP?accession=' + this.searchTerm, '_blank')
      } else if (this.searchTerm.startsWith('SPHERE')) {
        window.open('/family?accession=' + this.searchTerm, '_blank')
      } else {
        window.open(encodeURI('/text_search?query=' + this.searchTerm), '_blank')}
      }
  }
}
</script>